{"version":3,"sources":["webpack://smartcharts/./src/feed/Feed.ts"],"names":["Feed","_mainStore","state","startEpoch","endEpoch","chart","granularity","context","loader","margin","paginationLoader","binaryApi","stx","mainStore","tradingTimes","last_tick_timestamp","Date","getTime","_binaryApi","_connectionClosedDate","_emitter","_serverTime","_stx","_tradingTimes","_activeStreams","_isConnectionOpened","onRangeChanged","forceLoad","periodicity","calculateTimeUnitInterval","rangeTime","maxTicks","dtLeft","dtRight","setChartIsReady","CIQ","strToDateTime","getUTCDate","undefined","setRange","home","layout","range","scaleChart","saveLayout","ServerTime","getInstance","reaction","isConnectionOpened","onConnectionChanged","bind","EventEmitter","emitDelay","animations","liveScroll","running","stop","maxMasterDataSize","lockScroll","isDisplayFullMode","setMaxTicks","dataSet","length","Math","floor","scroll","isScrollLocationChanged","minimumZoomTicks","draw","symbol","period","interval","calculateGranularity","key","_getKey","_forgetStream","forget","suggestedStartDate","_suggestedEndDate","params","callback","console","log","i","error","setHasReachedEndOfData","updateOnPagination","symbolObject","localDate","getLocalDate","isComparisonChart","start","end","getTimezoneOffset","comparisonChartSymbol","symbolName","name","setState","isFeedUnavailable","notifier","notifyFeedUnavailable","dataCallback","quotes","suppressAlert","setChartAvailability","tickHistoryRequest","count","lastDigitStats","getHistoryOnly","String","isMarketOpened","delay","getDelayedMinutes","notifyDelayedMarket","subscription","DelayedSubscription","RealtimeSubscription","unsubscribeAll","initialFetch","new_quotes","response","filter","quote","updateLastDigitStats","text","message","notify","type","category","onChartData","tickResponse","isDestroyed","_appendChartData","notifyMarketClose","getTickHistory","TickHistoryFormatter","formatHistory","_trimQuotes","updateYaxisWidth","_emitDataUpdate","setMaxtTick","endDate","getUTCEpoch","isMainChart","emit","EVENT_START_PAGINATION","_getPaginationData","moreAvailable","EVENT_ON_PAGINATION","now","getEpoch","startLimit","ceil","result","max","hide","firstEpoch","getFirstEpoch","newStart","paginationEnd","hasReachedEndOfData","Object","keys","lastEpoch","lastStreamEpoch","isStaticChart","valueOf","slice","DT","current_tick_timestamp","_forgetIfEndEpoch","warn","updateChartData","Close","fillGaps","createDataSet","secondarySeries","noCreateDataSet","allowReplaceOHL","isChartReinitialized","prev","prevClose","dataUpdate","EVENT_MASTER_DATA_REINITIALIZE","EVENT_MASTER_DATA_UPDATE","EVENT_COMPARISON_DATA_UPDATE","on","off","isOpened","_onConnectionReopened","_onConnectionClosed","pause","_unpackKey","elapsedSeconds","maxIdleSeconds","refreshChart","_resumeStream","resume","then","split","startTickIndex","endTickIndex","trimmedQuotes","findIndex","tick","addon","candles","history","epoch","times"],"mappings":"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","file":"main.215aa2.hot-update.js","sourcesContent":["import EventEmitter from 'event-emitter-es6';\nimport { reaction } from 'mobx';\nimport { TicksHistoryRequest, TicksHistoryResponse } from '@deriv/api-types';\nimport { Listener, TError, TGranularity, TMainStore, TQuote } from 'src/types';\nimport { TCreateTickHistoryParams } from 'src/binaryapi/BinaryAPI';\nimport { BinaryAPI, TradingTimes } from 'src/binaryapi';\nimport Context from 'src/components/ui/Context';\nimport { TickHistoryFormatter } from './TickHistoryFormatter';\nimport { calculateGranularity, getUTCEpoch, calculateTimeUnitInterval, getUTCDate } from '../utils';\nimport { RealtimeSubscription, DelayedSubscription } from './subscription';\nimport ServerTime from '../utils/ServerTime';\nimport { TQuoteResponse } from './subscription/Subscription';\n\ntype TPaginationParams = {\n    period: number;\n    interval: string;\n    symbolObject: {\n        name: string;\n        symbol: string;\n    };\n};\n\ntype TPaginationCallback = (params: { quotes?: TQuote[]; error?: unknown; moreAvailable?: boolean }) => void;\n\nclass Feed {\n    last_tick_timestamp = new Date().getTime();\n\n    _binaryApi: BinaryAPI;\n    _connectionClosedDate?: Date;\n    _emitter: EventEmitter;\n    _mainStore: TMainStore;\n    _serverTime: ServerTime;\n    _stx: Context['stx'];\n    _tradingTimes: TradingTimes;\n    static get EVENT_MASTER_DATA_UPDATE() {\n        return 'EVENT_MASTER_DATA_UPDATE';\n    }\n    static get EVENT_MASTER_DATA_REINITIALIZE() {\n        return 'EVENT_MASTER_DATA_REASSIGN';\n    }\n    static get EVENT_COMPARISON_DATA_UPDATE() {\n        return 'EVENT_COMPARISON_DATA_UPDATE';\n    }\n    static get EVENT_START_PAGINATION() {\n        return 'EVENT_START_PAGINATION';\n    }\n    static get EVENT_ON_PAGINATION() {\n        return 'EVENT_ON_PAGINATION';\n    }\n    get startEpoch() {\n        return this._mainStore.state.startEpoch;\n    }\n    get endEpoch() {\n        return this._mainStore.state.endEpoch;\n    }\n    get granularity() {\n        return this._mainStore.chart.granularity;\n    }\n    get context() {\n        return this._mainStore.chart.context;\n    }\n    get loader() {\n        return this._mainStore.loader;\n    }\n    get margin() {\n        return this._mainStore.state.margin;\n    }\n    get paginationLoader() {\n        return this._mainStore.paginationLoader;\n    }\n    _activeStreams: Record<string, DelayedSubscription | RealtimeSubscription> = {};\n    _isConnectionOpened = true;\n    constructor(binaryApi: BinaryAPI, stx: Context['stx'], mainStore: TMainStore, tradingTimes: TradingTimes) {\n        this._stx = stx;\n        this._binaryApi = binaryApi;\n        this._mainStore = mainStore;\n        this._serverTime = ServerTime.getInstance();\n        this._tradingTimes = tradingTimes;\n        reaction(() => mainStore.state.isConnectionOpened, this.onConnectionChanged.bind(this));\n        this._emitter = new EventEmitter({ emitDelay: 0 });\n    }\n    onRangeChanged = (forceLoad: boolean) => {\n        const periodicity = calculateTimeUnitInterval(this.granularity);\n        const rangeTime = (this.granularity || 1) * this._stx.chart.maxTicks;\n        let dtLeft = null;\n        let dtRight = null;\n        this._mainStore.state.setChartIsReady(false);\n        if (!this.endEpoch) {\n            if (this.startEpoch) {\n                dtLeft = this.startEpoch ? CIQ.strToDateTime(getUTCDate(this.startEpoch)) : undefined;\n            }\n        } else {\n            dtLeft = CIQ.strToDateTime(getUTCDate(this.startEpoch || this.endEpoch - rangeTime));\n            dtRight = CIQ.strToDateTime(getUTCDate(this.endEpoch));\n        }\n        this._stx.setRange({ dtLeft, dtRight, periodicity, forceLoad }, () => {\n            if (!this.endEpoch && !this.startEpoch) {\n                this._stx.home();\n                delete this._stx.layout.range;\n            } else {\n                this.scaleChart();\n            }\n            this._mainStore.state.saveLayout();\n            this._mainStore.state.setChartIsReady(true);\n        });\n    };\n    scaleChart() {\n        if (this.startEpoch) {\n            if (this._stx.animations.liveScroll && this._stx.animations.liveScroll.running) {\n                this._stx.animations.liveScroll.stop();\n            }\n            if (!this.endEpoch) {\n                this._stx.maxMasterDataSize = 0;\n                this._stx.chart.lockScroll = true;\n            } else {\n                this._stx.chart.isDisplayFullMode = false;\n                this._stx.chart.lockScroll = false;\n            }\n            this._stx.setMaxTicks(\n                this._stx.chart.dataSet.length + (Math.floor(this._stx.chart.dataSet.length / 5) || 2)\n            );\n            this._stx.chart.scroll = this._stx.chart.dataSet.length;\n            this._stx.chart.isScrollLocationChanged = true;\n            /**\n             * for tick condition with few points, in that case, if your try to zoom in\n             * as the maxTicks is less than minimumZoomTicks, chart zoom out beside of\n             * zoom in, as a result, we try to override the minimumZoomTicks to prevent that\n             */\n            if (this._stx.chart.maxTicks < this._stx.minimumZoomTicks) {\n                this._stx.minimumZoomTicks = this._stx.chart.maxTicks - 1;\n            }\n            this._stx.draw();\n        }\n    }\n    // although not used, subscribe is overridden so that unsubscribe will be called by ChartIQ\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    subscribe() {}\n    // Do not call explicitly! Method below is called by ChartIQ when unsubscribing symbols.\n    unsubscribe({ symbol, period, interval }: { symbol: string; period: number; interval: string }) {\n        // the chart forgets the ticks_history of the main chart symbol before sending a new request in fetchInitialData function.\n        if (this._stx.chart.symbol === symbol) return;\n        const granularity = calculateGranularity(period, interval);\n        const key = this._getKey({ symbol, granularity });\n        this._forgetStream(key);\n    }\n    _forgetStream(key: string) {\n        if (this._activeStreams[key]) {\n            this._activeStreams[key].forget();\n            delete this._activeStreams[key];\n        }\n    }\n    async fetchInitialData( // this might be the way to refresh the chart\n        symbol: string,\n        suggestedStartDate: Date,\n        _suggestedEndDate: Date,\n        params: TPaginationParams,\n        callback: TPaginationCallback\n    ) {\n        console.log('');\n        for (let i=0; i<10; i++) {\n            console.error('FETCH INITIAL DATA: ' + i);\n        }\n        this.setHasReachedEndOfData(false);\n        this.paginationLoader.updateOnPagination(true);\n        const { period, interval, symbolObject } = params;\n        const granularity = calculateGranularity(period, interval);\n        const key = this._getKey({ symbol, granularity });\n        const localDate = this._serverTime.getLocalDate();\n        if (suggestedStartDate > localDate) suggestedStartDate = localDate;\n        if (!this.startEpoch && ((suggestedStartDate as unknown) as number) > (this.endEpoch as number)) {\n            suggestedStartDate = CIQ.strToDateTime(getUTCDate((this.endEpoch as number) - 200000));\n        }\n        const isComparisonChart = this._stx.chart.symbol !== symbol;\n        let start = this.startEpoch || Math.floor((((suggestedStartDate as unknown) as number) / 1000) | 0);\n        start = this.margin && this.startEpoch ? start - this.margin : start;\n        const end = this.margin && this.endEpoch ? this.endEpoch + this.margin : this.endEpoch;\n        if (isComparisonChart) {\n            // Strange issue where comparison series is offset by timezone...\n            start -= suggestedStartDate.getTimezoneOffset() * 60;\n        }\n        const comparisonChartSymbol = isComparisonChart ? symbol : undefined;\n        const symbolName = symbolObject.name;\n        this.loader.setState('chart-data');\n        if (this._tradingTimes.isFeedUnavailable(symbol)) {\n            this._mainStore.notifier.notifyFeedUnavailable(symbolName);\n            let dataCallback: {\n                error?: string;\n                suppressAlert?: boolean;\n                quotes: TQuote[];\n            } = { quotes: [] };\n            if (isComparisonChart) {\n                // Passing error will prevent the chart from being shown; for\n                // main chart we still want the chart to be shown, just disabled\n                dataCallback = { error: 'StreamingNotAllowed', suppressAlert: true, ...dataCallback };\n            } else {\n                this._mainStore.chart.setChartAvailability(false);\n            }\n            callback(dataCallback);\n            return;\n        }\n        const tickHistoryRequest: Partial<TCreateTickHistoryParams> = {\n            symbol,\n            granularity: granularity as TicksHistoryRequest['granularity'],\n            start: this.endEpoch ? start : undefined,\n            count: this.endEpoch ? undefined : this._mainStore.lastDigitStats.count,\n        };\n        let getHistoryOnly = false;\n        let quotes: TQuote[] | undefined;\n        if (end) {\n            // When there is end; no streaming required\n            tickHistoryRequest.end = String(end);\n            getHistoryOnly = true;\n        } else if (this._tradingTimes.isMarketOpened(symbol)) {\n            let subscription: DelayedSubscription | RealtimeSubscription;\n            const delay = this._tradingTimes.getDelayedMinutes(symbol);\n            if (delay > 0) {\n                this._mainStore.notifier.notifyDelayedMarket(symbolName, delay);\n                subscription = new DelayedSubscription(\n                    tickHistoryRequest as TCreateTickHistoryParams,\n                    this._binaryApi,\n                    this._stx,\n                    delay\n                );\n            } else {\n                subscription = new RealtimeSubscription(\n                    tickHistoryRequest as TCreateTickHistoryParams,\n                    this._binaryApi,\n                    this._stx\n                );\n            }\n            try {\n                // The chart should forget all ticks_history subscriptions when the symbol/granularity of the main chart is changed before sending the new request.\n                if (!isComparisonChart) {\n                    this.unsubscribeAll();\n                }\n                const { quotes: new_quotes, response } = await subscription.initialFetch();\n                quotes = new_quotes.filter(quote => {\n                    return new Date(`${quote.Date}Z`).getTime() / 1000 >= start;\n                });\n\n                if (!this.endEpoch) {\n                    this._mainStore.lastDigitStats.updateLastDigitStats(response);\n                }\n            } catch (error) {\n                const { message: text } = error as TError;\n                this._mainStore.notifier.notify({\n                    text: text as string,\n                    type: 'error',\n                    category: 'activesymbol',\n                });\n                callback({ quotes: [] });\n                this.paginationLoader.updateOnPagination(false);\n                return;\n            }\n            subscription.onChartData((tickResponse: TQuote[]) => {\n                // Append comming ticks to chart only if it belongs to selected symbol after symbol changes\n                if (isComparisonChart || symbol === this._stx.chart.symbol) {\n                    if (this._stx.isDestroyed) return;\n                    this._appendChartData(tickResponse, key, comparisonChartSymbol);\n                }\n            });\n            // if symbol is changed before request is completed, past request needs to be forgotten:\n            if (!isComparisonChart && this._stx.chart.symbol !== symbol) {\n                callback({ quotes: [] });\n                subscription.forget();\n                return;\n            }\n            this._activeStreams[key] = subscription;\n        } else {\n            this._mainStore.notifier.notifyMarketClose(symbolName);\n            // Although market is closed, we display the past tick history data\n            getHistoryOnly = true;\n        }\n        if (getHistoryOnly) {\n            const response: TicksHistoryResponse = await this._binaryApi.getTickHistory(\n                tickHistoryRequest as TCreateTickHistoryParams\n            );\n            quotes = TickHistoryFormatter.formatHistory(response);\n        }\n        if (!quotes) {\n            callback({ quotes: [] });\n            return;\n        }\n        quotes = this._trimQuotes(quotes);\n        callback({ quotes });\n        this._mainStore.chart.updateYaxisWidth();\n        this.scaleChart();\n        this._emitDataUpdate(quotes, comparisonChartSymbol, true);\n        this._mainStore.state.setMaxtTick();\n        this.paginationLoader.updateOnPagination(false);\n    }\n    async fetchPaginationData(\n        symbol: string,\n        suggestedStartDate: Date,\n        endDate: Date,\n        params: TPaginationParams,\n        callback: TPaginationCallback\n    ) {\n        const end = getUTCEpoch(endDate);\n        const start = getUTCEpoch(suggestedStartDate);\n        const { period, interval } = params;\n        const granularity = calculateGranularity(period, interval);\n        const isMainChart = this._stx.chart.symbol === symbol;\n        if (isMainChart) {\n            // ignore comparisons\n            this._emitter.emit(Feed.EVENT_START_PAGINATION, { start, end });\n        }\n        await this._getPaginationData(symbol, granularity, start, end, callback);\n    }\n    async _getPaginationData(\n        symbol: string,\n        granularity: TGranularity,\n        start: number,\n        end: number,\n        callback: TPaginationCallback\n    ) {\n        const isMainChart = this._stx.chart.symbol === symbol;\n        // TODO There is no need to get historical data before startTime\n        if (this.startEpoch /* && start < this.startEpoch */ || (this.endEpoch && end > this.endEpoch)) {\n            callback({ moreAvailable: false, quotes: [] });\n            if (isMainChart) {\n                // ignore comparisons\n                this._emitter.emit(Feed.EVENT_ON_PAGINATION, { start, end });\n                this.setHasReachedEndOfData(true);\n            }\n            return;\n        }\n        const now = this._serverTime.getEpoch();\n        // Tick history data only goes as far back as 3 years:\n        const startLimit = now - Math.ceil(2.8 * 365 * 24 * 60 * 60); /* == 3 Years */\n        let result: Partial<TQuoteResponse> = { quotes: [] };\n        let firstEpoch: number | undefined;\n        if (end > startLimit) {\n            try {\n                const response = await this._binaryApi.getTickHistory({\n                    symbol,\n                    granularity: granularity as TicksHistoryRequest['granularity'],\n                    start: Math.floor(Math.max(start, startLimit)),\n                    end: String(end),\n                });\n                if (response.error) {\n                    const { message: text } = response.error as TError;\n                    this.loader.hide();\n                    this.paginationLoader.updateOnPagination(false);\n                    this._mainStore.notifier.notify({\n                        text: text as string,\n                        type: 'error',\n                        category: 'activesymbol',\n                    });\n                    callback({ error: response.error });\n                    return;\n                }\n                firstEpoch = Feed.getFirstEpoch(response);\n                if (firstEpoch === undefined || firstEpoch === end) {\n                    const newStart = start - (end - start);\n                    if (newStart <= startLimit) {\n                        // Passed available range. Prevent anymore pagination requests:\n                        callback({ moreAvailable: false, quotes: [] });\n                        this.setHasReachedEndOfData(true);\n                        return;\n                    }\n                    // Recursively extend the date range for more data until we exceed available range\n                    await this._getPaginationData(symbol, granularity, newStart, end, callback);\n                    return;\n                }\n                result.quotes = TickHistoryFormatter.formatHistory(response);\n                if (firstEpoch <= startLimit) {\n                    callback({ moreAvailable: false, quotes: [] });\n                    this.setHasReachedEndOfData(true);\n                }\n            } catch (err) {\n                console.error(err);\n                result = { error: err };\n            }\n        }\n        callback(result);\n        if (isMainChart) {\n            // ignore comparisons\n            // prevent overlapping by setting pagination end as firstEpoch\n            // if 'end' is greater than firstEpoch from feed\n            const paginationEnd = firstEpoch && end > firstEpoch ? firstEpoch : end;\n            this._emitter.emit(Feed.EVENT_ON_PAGINATION, { start, end: paginationEnd });\n        }\n    }\n    setHasReachedEndOfData(hasReachedEndOfData: boolean) {\n        this.paginationLoader.updateOnPagination(false);\n        if (this._mainStore.state.hasReachedEndOfData !== hasReachedEndOfData) {\n            this._mainStore.state.hasReachedEndOfData = hasReachedEndOfData;\n        }\n    }\n    unsubscribeAll() {\n        for (const key of Object.keys(this._activeStreams)) {\n            this._forgetStream(key);\n        }\n    }\n    _forgetIfEndEpoch(key: string) {\n        const subscription = this._activeStreams[key];\n        let result = true;\n        if (!subscription) {\n            return;\n        }\n        const lastEpoch = subscription.lastStreamEpoch;\n        if (\n            this.endEpoch &&\n            lastEpoch !== undefined &&\n            this.granularity !== undefined &&\n            lastEpoch + this.granularity > this.endEpoch\n        ) {\n            if (\n                this._activeStreams[key] &&\n                this.granularity === 0 &&\n                !this._mainStore.state.isStaticChart &&\n                CIQ.strToDateTime(getUTCDate(this.endEpoch)).valueOf() >=\n                    this._stx.chart.dataSet.slice(-1)[0]?.DT.valueOf()\n            ) {\n                result = false;\n            }\n            this._forgetStream(key);\n        } else {\n            result = false;\n        }\n        return result;\n    }\n    _appendChartData(quotes: TQuote[], key: string, comparisonChartSymbol?: string) {\n        // console.log('');\n        // console.warn('HEREEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE');\n        // console.log(this.last_tick_timestamp);\n\n        const current_tick_timestamp = new Date().getTime();\n        // THE ISSUE CAN BE FIXED HERE\n        // console.log('');\n        // for (let i=0; i<10; i++) {\n        //     console.error('FETCH INITIAL DATA: ' + i);\n        // }\n\n        // console.error(current_tick_timestamp - this.last_tick_timestamp);\n\n        // if (current_tick_timestamp - this.last_tick_timestamp < 2 * 1000) {\n        //     console.warn('RIGHT');\n        // }\n        // else {\n        //     console.error('BWOKEN');\n        //     // this._mainStore.chart.refreshChart();\n        // }\n        // this.last_tick_timestamp = current_tick_timestamp;\n\n        if (this._forgetIfEndEpoch(key) && !this._activeStreams[key]) {\n            console.log('');\n            console.warn('HERE 1');\n            quotes = [];\n            return;\n        }\n        if (\n            this.endEpoch &&\n            this._stx.chart.dataSet.slice(-1)[0] &&\n            CIQ.strToDateTime(getUTCDate(this.endEpoch)).valueOf() !== this._stx.chart.dataSet.slice(-1)[0].DT.valueOf()\n        ) {\n            console.log('');\n            console.warn('HERE 2');\n            this._stx.updateChartData(\n                [\n                    {\n                        DT: CIQ.strToDateTime(getUTCDate(this.endEpoch)),\n                        Close: null,\n                    },\n                ],\n                null,\n                { fillGaps: true }\n            );\n            this._stx.createDataSet();\n        }\n        if (comparisonChartSymbol) {\n            console.log('');\n            console.warn('HERE 3');\n            this._stx.updateChartData(quotes, null, {\n                secondarySeries: comparisonChartSymbol,\n                noCreateDataSet: true,\n            });\n        } else {\n            console.log('');\n            console.warn('HERE 4');\n            console.error(current_tick_timestamp - this.last_tick_timestamp);\n            if (current_tick_timestamp - this.last_tick_timestamp < 2 * 1000) {\n                console.warn('LEFT');\n                this._stx.updateChartData(quotes, null, {\n                    allowReplaceOHL: true,\n                });\n                this._stx.createDataSet();\n            }\n            else {\n                console.error('BWOKEN');\n                // this._mainStore.chart.refreshChart();\n            }\n            this.last_tick_timestamp = current_tick_timestamp;\n        }\n        console.log('');\n            console.warn('HERE 5');\n        this._emitDataUpdate(quotes, comparisonChartSymbol);\n    }\n    _emitDataUpdate(quotes: TQuote[], comparisonChartSymbol?: string, isChartReinitialized = false) {\n        const prev = quotes[quotes.length - 2];\n        const prevClose = prev !== undefined ? prev.Close : undefined;\n        const dataUpdate = {\n            ...quotes[quotes.length - 1],\n            prevClose,\n        };\n        if (!comparisonChartSymbol) {\n            if (isChartReinitialized) {\n                this._emitter.emit(Feed.EVENT_MASTER_DATA_REINITIALIZE);\n                this._mainStore.chart.setChartAvailability(true);\n            } else {\n                this._emitter.emit(Feed.EVENT_MASTER_DATA_UPDATE, dataUpdate);\n            }\n        } else {\n            this._emitter.emit(Feed.EVENT_COMPARISON_DATA_UPDATE, {\n                symbol: comparisonChartSymbol,\n                ...dataUpdate,\n            });\n        }\n    }\n    static getFirstEpoch({ candles, history }: TicksHistoryResponse) {\n        if (candles && candles.length > 0) {\n            return candles[0].epoch;\n        }\n        if (history && history.times && history.times.length > 0) {\n            const { times } = history;\n            return +times[0];\n        }\n    }\n    onMasterDataUpdate(callback: Listener) {\n        this._emitter.on(Feed.EVENT_MASTER_DATA_UPDATE, callback);\n    }\n    offMasterDataUpdate(callback: Listener) {\n        this._emitter.off(Feed.EVENT_MASTER_DATA_UPDATE, callback);\n    }\n    onMasterDataReinitialize(callback: Listener) {\n        this._emitter.on(Feed.EVENT_MASTER_DATA_REINITIALIZE, callback);\n    }\n    offMasterDataReinitialize(callback: Listener) {\n        this._emitter.off(Feed.EVENT_MASTER_DATA_REINITIALIZE, callback);\n    }\n    onComparisonDataUpdate(callback: Listener) {\n        this._emitter.on(Feed.EVENT_COMPARISON_DATA_UPDATE, callback);\n    }\n    onPagination(callback: Listener) {\n        this._emitter.on(Feed.EVENT_ON_PAGINATION, callback);\n    }\n    offPagination(callback: Listener) {\n        this._emitter.off(Feed.EVENT_ON_PAGINATION, callback);\n    }\n    onStartPagination(callback: Listener) {\n        this._emitter.on(Feed.EVENT_START_PAGINATION, callback);\n    }\n    offStartPagination(callback: Listener) {\n        this._emitter.off(Feed.EVENT_START_PAGINATION, callback);\n    }\n    onConnectionChanged() {\n        const isOpened = this._mainStore.state.isConnectionOpened;\n        if (isOpened === undefined || isOpened === this._isConnectionOpened) {\n            return;\n        }\n        this._isConnectionOpened = isOpened;\n        if (isOpened) {\n            this._onConnectionReopened();\n        } else {\n            this._onConnectionClosed();\n        }\n    }\n    _onConnectionClosed() {\n        for (const key in this._activeStreams) {\n            this._activeStreams[key].pause();\n        }\n        this._connectionClosedDate = new Date();\n    }\n    _onConnectionReopened() {\n        const keys = Object.keys(this._activeStreams);\n        if (keys.length === 0) {\n            return;\n        }\n        const { granularity } = this._unpackKey(keys[0]);\n        const elapsedSeconds =\n            ((((new Date() as unknown) as number) - ((this._connectionClosedDate as unknown) as number)) / 1000) | 0;\n        const maxIdleSeconds = (granularity || 1) * this._stx.chart.maxTicks;\n        if (elapsedSeconds >= maxIdleSeconds) {\n            this._mainStore.chart.refreshChart();\n        } else {\n            for (const key of keys) {\n                this._resumeStream(key);\n            }\n        }\n        this._connectionClosedDate = undefined;\n    }\n    _resumeStream(key: string) {\n        const { symbol } = this._unpackKey(key);\n        const comparisonChartSymbol = this._stx.chart.symbol !== symbol ? symbol : undefined;\n\n        this._activeStreams[key].resume().then((params?: TQuoteResponse) => {\n            const { quotes } = params as TQuoteResponse;\n            if (this._stx.isDestroyed) return;\n            this._appendChartData(quotes, key, comparisonChartSymbol);\n        });\n    }\n    _getKey({ symbol, granularity }: { symbol: string; granularity: TGranularity }) {\n        return `${symbol}-${granularity}`;\n    }\n    _unpackKey(key: string) {\n        const [symbol, granularity] = key.split('-');\n        return { symbol, granularity: +granularity };\n    }\n    _trimQuotes(quotes: TQuote[] = []) {\n        let startTickIndex = null;\n        let endTickIndex = null;\n        let trimmedQuotes = quotes;\n        if (!trimmedQuotes.length) return [];\n        if (this.startEpoch && this.margin) {\n            startTickIndex = trimmedQuotes.findIndex(\n                tick => CIQ.strToDateTime(tick.Date) >= CIQ.strToDateTime(getUTCDate(this.startEpoch as number))\n            );\n            if (startTickIndex > -1) {\n                trimmedQuotes = trimmedQuotes.slice(startTickIndex - 1);\n            }\n        }\n        if (this.endEpoch && this.margin) {\n            endTickIndex = trimmedQuotes.findIndex(\n                tick => CIQ.strToDateTime(tick.Date) >= CIQ.strToDateTime(getUTCDate(this.endEpoch as number))\n            );\n            if (endTickIndex > -1) {\n                const addon = trimmedQuotes[endTickIndex].Date === getUTCDate(this.endEpoch) ? 2 : 1;\n                trimmedQuotes = trimmedQuotes.slice(0, endTickIndex + addon);\n            }\n        }\n        return trimmedQuotes;\n    }\n}\nexport default Feed;\n"],"sourceRoot":""}