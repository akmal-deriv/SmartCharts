{"version":3,"sources":["webpack://smartcharts/./src/feed/Feed.ts"],"names":["Feed","_mainStore","state","startEpoch","endEpoch","chart","granularity","context","loader","margin","paginationLoader","binaryApi","stx","mainStore","tradingTimes","_binaryApi","_connectionClosedDate","_emitter","_last_tick_timestamp","_serverTime","_stx","_tradingTimes","_activeStreams","_isConnectionOpened","onRangeChanged","forceLoad","periodicity","calculateTimeUnitInterval","rangeTime","maxTicks","dtLeft","dtRight","setChartIsReady","CIQ","strToDateTime","getUTCDate","undefined","setRange","home","layout","range","scaleChart","saveLayout","ServerTime","getInstance","reaction","isConnectionOpened","onConnectionChanged","bind","EventEmitter","emitDelay","animations","liveScroll","running","stop","maxMasterDataSize","lockScroll","isDisplayFullMode","setMaxTicks","dataSet","length","Math","floor","scroll","isScrollLocationChanged","minimumZoomTicks","draw","symbol","period","interval","calculateGranularity","key","_getKey","_forgetStream","forget","suggestedStartDate","_suggestedEndDate","params","callback","getEpoch","setHasReachedEndOfData","updateOnPagination","symbolObject","localDate","getLocalDate","isComparisonChart","start","end","getTimezoneOffset","comparisonChartSymbol","symbolName","name","setState","isFeedUnavailable","notifier","notifyFeedUnavailable","dataCallback","quotes","error","suppressAlert","setChartAvailability","tickHistoryRequest","count","lastDigitStats","getHistoryOnly","String","isMarketOpened","delay","getDelayedMinutes","notifyDelayedMarket","subscription","DelayedSubscription","RealtimeSubscription","unsubscribeAll","initialFetch","new_quotes","response","filter","quote","Date","getTime","updateLastDigitStats","text","message","notify","type","category","onChartData","tickResponse","isDestroyed","_appendChartData","notifyMarketClose","getTickHistory","TickHistoryFormatter","formatHistory","_trimQuotes","updateYaxisWidth","_emitDataUpdate","setMaxtTick","endDate","getUTCEpoch","isMainChart","emit","EVENT_START_PAGINATION","_getPaginationData","moreAvailable","EVENT_ON_PAGINATION","now","startLimit","ceil","result","max","hide","firstEpoch","getFirstEpoch","newStart","console","paginationEnd","hasReachedEndOfData","Object","keys","lastEpoch","lastStreamEpoch","isStaticChart","valueOf","slice","DT","log","warn","current_tick_timestamp","_forgetIfEndEpoch","updateChartData","Close","fillGaps","createDataSet","secondarySeries","noCreateDataSet","allowReplaceOHL","refreshChart","isChartReinitialized","prev","prevClose","dataUpdate","EVENT_MASTER_DATA_REINITIALIZE","EVENT_MASTER_DATA_UPDATE","EVENT_COMPARISON_DATA_UPDATE","on","off","isOpened","_onConnectionReopened","_onConnectionClosed","pause","_unpackKey","elapsedSeconds","maxIdleSeconds","_resumeStream","resume","then","split","startTickIndex","endTickIndex","trimmedQuotes","findIndex","tick","addon","candles","history","epoch","times"],"mappings":"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","file":"main.dcd901.hot-update.js","sourcesContent":["import EventEmitter from 'event-emitter-es6';\nimport { reaction } from 'mobx';\nimport { TicksHistoryRequest, TicksHistoryResponse } from '@deriv/api-types';\nimport { Listener, TError, TGranularity, TMainStore, TQuote } from 'src/types';\nimport { TCreateTickHistoryParams } from 'src/binaryapi/BinaryAPI';\nimport { BinaryAPI, TradingTimes } from 'src/binaryapi';\nimport Context from 'src/components/ui/Context';\nimport { TickHistoryFormatter } from './TickHistoryFormatter';\nimport { calculateGranularity, getUTCEpoch, calculateTimeUnitInterval, getUTCDate } from '../utils';\nimport { RealtimeSubscription, DelayedSubscription } from './subscription';\nimport ServerTime from '../utils/ServerTime';\nimport { TQuoteResponse } from './subscription/Subscription';\n\ntype TPaginationParams = {\n    period: number;\n    interval: string;\n    symbolObject: {\n        name: string;\n        symbol: string;\n    };\n};\n\ntype TPaginationCallback = (params: { quotes?: TQuote[]; error?: unknown; moreAvailable?: boolean }) => void;\n\nclass Feed {\n    _binaryApi: BinaryAPI;\n    _connectionClosedDate?: Date;\n    _emitter: EventEmitter;\n    _last_tick_timestamp: number;\n    _mainStore: TMainStore;\n    _serverTime: ServerTime;\n    _stx: Context['stx'];\n    _tradingTimes: TradingTimes;\n    static get EVENT_MASTER_DATA_UPDATE() {\n        return 'EVENT_MASTER_DATA_UPDATE';\n    }\n    static get EVENT_MASTER_DATA_REINITIALIZE() {\n        return 'EVENT_MASTER_DATA_REASSIGN';\n    }\n    static get EVENT_COMPARISON_DATA_UPDATE() {\n        return 'EVENT_COMPARISON_DATA_UPDATE';\n    }\n    static get EVENT_START_PAGINATION() {\n        return 'EVENT_START_PAGINATION';\n    }\n    static get EVENT_ON_PAGINATION() {\n        return 'EVENT_ON_PAGINATION';\n    }\n    get startEpoch() {\n        return this._mainStore.state.startEpoch;\n    }\n    get endEpoch() {\n        return this._mainStore.state.endEpoch;\n    }\n    get granularity() {\n        return this._mainStore.chart.granularity;\n    }\n    get context() {\n        return this._mainStore.chart.context;\n    }\n    get loader() {\n        return this._mainStore.loader;\n    }\n    get margin() {\n        return this._mainStore.state.margin;\n    }\n    get paginationLoader() {\n        return this._mainStore.paginationLoader;\n    }\n    _activeStreams: Record<string, DelayedSubscription | RealtimeSubscription> = {};\n    _isConnectionOpened = true;\n    constructor(binaryApi: BinaryAPI, stx: Context['stx'], mainStore: TMainStore, tradingTimes: TradingTimes) {\n        this._stx = stx;\n        this._binaryApi = binaryApi;\n        this._mainStore = mainStore;\n        this._serverTime = ServerTime.getInstance();\n        this._tradingTimes = tradingTimes;\n        reaction(() => mainStore.state.isConnectionOpened, this.onConnectionChanged.bind(this));\n        this._emitter = new EventEmitter({ emitDelay: 0 });\n        this._last_tick_timestamp = 0;\n    }\n    onRangeChanged = (forceLoad: boolean) => {\n        const periodicity = calculateTimeUnitInterval(this.granularity);\n        const rangeTime = (this.granularity || 1) * this._stx.chart.maxTicks;\n        let dtLeft = null;\n        let dtRight = null;\n        this._mainStore.state.setChartIsReady(false);\n        if (!this.endEpoch) {\n            if (this.startEpoch) {\n                dtLeft = this.startEpoch ? CIQ.strToDateTime(getUTCDate(this.startEpoch)) : undefined;\n            }\n        } else {\n            dtLeft = CIQ.strToDateTime(getUTCDate(this.startEpoch || this.endEpoch - rangeTime));\n            dtRight = CIQ.strToDateTime(getUTCDate(this.endEpoch));\n        }\n        this._stx.setRange({ dtLeft, dtRight, periodicity, forceLoad }, () => {\n            if (!this.endEpoch && !this.startEpoch) {\n                this._stx.home();\n                delete this._stx.layout.range;\n            } else {\n                this.scaleChart();\n            }\n            this._mainStore.state.saveLayout();\n            this._mainStore.state.setChartIsReady(true);\n        });\n    };\n    scaleChart() {\n        if (this.startEpoch) {\n            if (this._stx.animations.liveScroll && this._stx.animations.liveScroll.running) {\n                this._stx.animations.liveScroll.stop();\n            }\n            if (!this.endEpoch) {\n                this._stx.maxMasterDataSize = 0;\n                this._stx.chart.lockScroll = true;\n            } else {\n                this._stx.chart.isDisplayFullMode = false;\n                this._stx.chart.lockScroll = false;\n            }\n            this._stx.setMaxTicks(\n                this._stx.chart.dataSet.length + (Math.floor(this._stx.chart.dataSet.length / 5) || 2)\n            );\n            this._stx.chart.scroll = this._stx.chart.dataSet.length;\n            this._stx.chart.isScrollLocationChanged = true;\n            /**\n             * for tick condition with few points, in that case, if your try to zoom in\n             * as the maxTicks is less than minimumZoomTicks, chart zoom out beside of\n             * zoom in, as a result, we try to override the minimumZoomTicks to prevent that\n             */\n            if (this._stx.chart.maxTicks < this._stx.minimumZoomTicks) {\n                this._stx.minimumZoomTicks = this._stx.chart.maxTicks - 1;\n            }\n            this._stx.draw();\n        }\n    }\n    // although not used, subscribe is overridden so that unsubscribe will be called by ChartIQ\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    subscribe() {}\n    // Do not call explicitly! Method below is called by ChartIQ when unsubscribing symbols.\n    unsubscribe({ symbol, period, interval }: { symbol: string; period: number; interval: string }) {\n        // the chart forgets the ticks_history of the main chart symbol before sending a new request in fetchInitialData function.\n        if (this._stx.chart.symbol === symbol) return;\n        const granularity = calculateGranularity(period, interval);\n        const key = this._getKey({ symbol, granularity });\n        this._forgetStream(key);\n    }\n    _forgetStream(key: string) {\n        if (this._activeStreams[key]) {\n            this._activeStreams[key].forget();\n            delete this._activeStreams[key];\n        }\n    }\n    async fetchInitialData(\n        symbol: string,\n        suggestedStartDate: Date,\n        _suggestedEndDate: Date,\n        params: TPaginationParams,\n        callback: TPaginationCallback\n    ) {\n        this._last_tick_timestamp = this._serverTime.getEpoch();\n        this.setHasReachedEndOfData(false);\n        this.paginationLoader.updateOnPagination(true);\n        const { period, interval, symbolObject } = params;\n        const granularity = calculateGranularity(period, interval);\n        const key = this._getKey({ symbol, granularity });\n        const localDate = this._serverTime.getLocalDate();\n        if (suggestedStartDate > localDate) suggestedStartDate = localDate;\n        if (!this.startEpoch && ((suggestedStartDate as unknown) as number) > (this.endEpoch as number)) {\n            suggestedStartDate = CIQ.strToDateTime(getUTCDate((this.endEpoch as number) - 200000));\n        }\n        const isComparisonChart = this._stx.chart.symbol !== symbol;\n        let start = this.startEpoch || Math.floor((((suggestedStartDate as unknown) as number) / 1000) | 0);\n        start = this.margin && this.startEpoch ? start - this.margin : start;\n        const end = this.margin && this.endEpoch ? this.endEpoch + this.margin : this.endEpoch;\n        if (isComparisonChart) {\n            // Strange issue where comparison series is offset by timezone...\n            start -= suggestedStartDate.getTimezoneOffset() * 60;\n        }\n        const comparisonChartSymbol = isComparisonChart ? symbol : undefined;\n        const symbolName = symbolObject.name;\n        this.loader.setState('chart-data');\n        if (this._tradingTimes.isFeedUnavailable(symbol)) {\n            this._mainStore.notifier.notifyFeedUnavailable(symbolName);\n            let dataCallback: {\n                error?: string;\n                suppressAlert?: boolean;\n                quotes: TQuote[];\n            } = { quotes: [] };\n            if (isComparisonChart) {\n                // Passing error will prevent the chart from being shown; for\n                // main chart we still want the chart to be shown, just disabled\n                dataCallback = { error: 'StreamingNotAllowed', suppressAlert: true, ...dataCallback };\n            } else {\n                this._mainStore.chart.setChartAvailability(false);\n            }\n            callback(dataCallback);\n            return;\n        }\n        const tickHistoryRequest: Partial<TCreateTickHistoryParams> = {\n            symbol,\n            granularity: granularity as TicksHistoryRequest['granularity'],\n            start: this.endEpoch ? start : undefined,\n            count: this.endEpoch ? undefined : this._mainStore.lastDigitStats.count,\n        };\n        let getHistoryOnly = false;\n        let quotes: TQuote[] | undefined;\n        if (end) {\n            // When there is end; no streaming required\n            tickHistoryRequest.end = String(end);\n            getHistoryOnly = true;\n        } else if (this._tradingTimes.isMarketOpened(symbol)) {\n            let subscription: DelayedSubscription | RealtimeSubscription;\n            const delay = this._tradingTimes.getDelayedMinutes(symbol);\n            if (delay > 0) {\n                this._mainStore.notifier.notifyDelayedMarket(symbolName, delay);\n                subscription = new DelayedSubscription(\n                    tickHistoryRequest as TCreateTickHistoryParams,\n                    this._binaryApi,\n                    this._stx,\n                    delay\n                );\n            } else {\n                subscription = new RealtimeSubscription(\n                    tickHistoryRequest as TCreateTickHistoryParams,\n                    this._binaryApi,\n                    this._stx\n                );\n            }\n            try {\n                // The chart should forget all ticks_history subscriptions when the symbol/granularity of the main chart is changed before sending the new request.\n                if (!isComparisonChart) {\n                    this.unsubscribeAll();\n                }\n                const { quotes: new_quotes, response } = await subscription.initialFetch();\n                quotes = new_quotes.filter(quote => {\n                    return new Date(`${quote.Date}Z`).getTime() / 1000 >= start;\n                });\n\n                if (!this.endEpoch) {\n                    this._mainStore.lastDigitStats.updateLastDigitStats(response);\n                }\n            } catch (error) {\n                const { message: text } = error as TError;\n                this._mainStore.notifier.notify({\n                    text: text as string,\n                    type: 'error',\n                    category: 'activesymbol',\n                });\n                callback({ quotes: [] });\n                this.paginationLoader.updateOnPagination(false);\n                return;\n            }\n            subscription.onChartData((tickResponse: TQuote[]) => {\n                // Append comming ticks to chart only if it belongs to selected symbol after symbol changes\n                if (isComparisonChart || symbol === this._stx.chart.symbol) {\n                    if (this._stx.isDestroyed) return;\n                    this._appendChartData(tickResponse, key, comparisonChartSymbol);\n                }\n            });\n            // if symbol is changed before request is completed, past request needs to be forgotten:\n            if (!isComparisonChart && this._stx.chart.symbol !== symbol) {\n                callback({ quotes: [] });\n                subscription.forget();\n                return;\n            }\n            this._activeStreams[key] = subscription;\n        } else {\n            this._mainStore.notifier.notifyMarketClose(symbolName);\n            // Although market is closed, we display the past tick history data\n            getHistoryOnly = true;\n        }\n        if (getHistoryOnly) {\n            const response: TicksHistoryResponse = await this._binaryApi.getTickHistory(\n                tickHistoryRequest as TCreateTickHistoryParams\n            );\n            quotes = TickHistoryFormatter.formatHistory(response);\n        }\n        if (!quotes) {\n            callback({ quotes: [] });\n            return;\n        }\n        quotes = this._trimQuotes(quotes);\n        callback({ quotes });\n        this._mainStore.chart.updateYaxisWidth();\n        this.scaleChart();\n        this._emitDataUpdate(quotes, comparisonChartSymbol, true);\n        this._mainStore.state.setMaxtTick();\n        this.paginationLoader.updateOnPagination(false);\n    }\n    async fetchPaginationData(\n        symbol: string,\n        suggestedStartDate: Date,\n        endDate: Date,\n        params: TPaginationParams,\n        callback: TPaginationCallback\n    ) {\n        const end = getUTCEpoch(endDate);\n        const start = getUTCEpoch(suggestedStartDate);\n        const { period, interval } = params;\n        const granularity = calculateGranularity(period, interval);\n        const isMainChart = this._stx.chart.symbol === symbol;\n        if (isMainChart) {\n            // ignore comparisons\n            this._emitter.emit(Feed.EVENT_START_PAGINATION, { start, end });\n        }\n        await this._getPaginationData(symbol, granularity, start, end, callback);\n    }\n    async _getPaginationData(\n        symbol: string,\n        granularity: TGranularity,\n        start: number,\n        end: number,\n        callback: TPaginationCallback\n    ) {\n        const isMainChart = this._stx.chart.symbol === symbol;\n        // TODO There is no need to get historical data before startTime\n        if (this.startEpoch /* && start < this.startEpoch */ || (this.endEpoch && end > this.endEpoch)) {\n            callback({ moreAvailable: false, quotes: [] });\n            if (isMainChart) {\n                // ignore comparisons\n                this._emitter.emit(Feed.EVENT_ON_PAGINATION, { start, end });\n                this.setHasReachedEndOfData(true);\n            }\n            return;\n        }\n        const now = this._serverTime.getEpoch();\n        // Tick history data only goes as far back as 3 years:\n        const startLimit = now - Math.ceil(2.8 * 365 * 24 * 60 * 60); /* == 3 Years */\n        let result: Partial<TQuoteResponse> = { quotes: [] };\n        let firstEpoch: number | undefined;\n        if (end > startLimit) {\n            try {\n                const response = await this._binaryApi.getTickHistory({\n                    symbol,\n                    granularity: granularity as TicksHistoryRequest['granularity'],\n                    start: Math.floor(Math.max(start, startLimit)),\n                    end: String(end),\n                });\n                if (response.error) {\n                    const { message: text } = response.error as TError;\n                    this.loader.hide();\n                    this.paginationLoader.updateOnPagination(false);\n                    this._mainStore.notifier.notify({\n                        text: text as string,\n                        type: 'error',\n                        category: 'activesymbol',\n                    });\n                    callback({ error: response.error });\n                    return;\n                }\n                firstEpoch = Feed.getFirstEpoch(response);\n                if (firstEpoch === undefined || firstEpoch === end) {\n                    const newStart = start - (end - start);\n                    if (newStart <= startLimit) {\n                        // Passed available range. Prevent anymore pagination requests:\n                        callback({ moreAvailable: false, quotes: [] });\n                        this.setHasReachedEndOfData(true);\n                        return;\n                    }\n                    // Recursively extend the date range for more data until we exceed available range\n                    await this._getPaginationData(symbol, granularity, newStart, end, callback);\n                    return;\n                }\n                result.quotes = TickHistoryFormatter.formatHistory(response);\n                if (firstEpoch <= startLimit) {\n                    callback({ moreAvailable: false, quotes: [] });\n                    this.setHasReachedEndOfData(true);\n                }\n            } catch (err) {\n                console.error(err);\n                result = { error: err };\n            }\n        }\n        callback(result);\n        if (isMainChart) {\n            // ignore comparisons\n            // prevent overlapping by setting pagination end as firstEpoch\n            // if 'end' is greater than firstEpoch from feed\n            const paginationEnd = firstEpoch && end > firstEpoch ? firstEpoch : end;\n            this._emitter.emit(Feed.EVENT_ON_PAGINATION, { start, end: paginationEnd });\n        }\n    }\n    setHasReachedEndOfData(hasReachedEndOfData: boolean) {\n        this.paginationLoader.updateOnPagination(false);\n        if (this._mainStore.state.hasReachedEndOfData !== hasReachedEndOfData) {\n            this._mainStore.state.hasReachedEndOfData = hasReachedEndOfData;\n        }\n    }\n    unsubscribeAll() {\n        for (const key of Object.keys(this._activeStreams)) {\n            this._forgetStream(key);\n        }\n    }\n    _forgetIfEndEpoch(key: string) {\n        const subscription = this._activeStreams[key];\n        let result = true;\n        if (!subscription) {\n            return;\n        }\n        const lastEpoch = subscription.lastStreamEpoch;\n        if (\n            this.endEpoch &&\n            lastEpoch !== undefined &&\n            this.granularity !== undefined &&\n            lastEpoch + this.granularity > this.endEpoch\n        ) {\n            if (\n                this._activeStreams[key] &&\n                this.granularity === 0 &&\n                !this._mainStore.state.isStaticChart &&\n                CIQ.strToDateTime(getUTCDate(this.endEpoch)).valueOf() >=\n                    this._stx.chart.dataSet.slice(-1)[0]?.DT.valueOf()\n            ) {\n                result = false;\n            }\n            this._forgetStream(key);\n        } else {\n            result = false;\n        }\n        return result;\n    }\n    _appendChartData(quotes: TQuote[], key: string, comparisonChartSymbol?: string) {\n        console.log('');\n        console.warn('APPEND CHART DATA: ');\n        console.log(this._last_tick_timestamp);\n        // console.log(this.last_tick_timestamp);\n        console.log(this._serverTime.getEpoch());\n        // console.log(new Date().getTime());\n        const current_tick_timestamp = this._serverTime.getEpoch();\n        // console.error(_current_tick_timestamp - this._last_tick_timestamp);\n        console.error(current_tick_timestamp - this._last_tick_timestamp);\n        // THE ISSUE CAN BE FIXED HERE\n        if (this._forgetIfEndEpoch(key) && !this._activeStreams[key]) {\n            quotes = [];\n            return;\n        }\n        if (\n            this.endEpoch &&\n            this._stx.chart.dataSet.slice(-1)[0] &&\n            CIQ.strToDateTime(getUTCDate(this.endEpoch)).valueOf() !== this._stx.chart.dataSet.slice(-1)[0].DT.valueOf()\n        ) {\n            this._stx.updateChartData(\n                [\n                    {\n                        DT: CIQ.strToDateTime(getUTCDate(this.endEpoch)),\n                        Close: null,\n                    },\n                ],\n                null,\n                { fillGaps: true }\n            );\n            this._stx.createDataSet();\n        }\n        if (comparisonChartSymbol) {\n            this._stx.updateChartData(quotes, null, {\n                secondarySeries: comparisonChartSymbol,\n                noCreateDataSet: true,\n            });\n        } else {\n            if (current_tick_timestamp - this._last_tick_timestamp < 60) {\n                this._stx.updateChartData(quotes, null, {\n                    allowReplaceOHL: true,\n                });\n                this._stx.createDataSet();\n            }\n            else {\n                this._mainStore.chart.refreshChart();\n            }\n            this._last_tick_timestamp = current_tick_timestamp;\n        }\n        this._emitDataUpdate(quotes, comparisonChartSymbol);\n    }\n    _emitDataUpdate(quotes: TQuote[], comparisonChartSymbol?: string, isChartReinitialized = false) {\n        const prev = quotes[quotes.length - 2];\n        const prevClose = prev !== undefined ? prev.Close : undefined;\n        const dataUpdate = {\n            ...quotes[quotes.length - 1],\n            prevClose,\n        };\n        if (!comparisonChartSymbol) {\n            if (isChartReinitialized) {\n                this._emitter.emit(Feed.EVENT_MASTER_DATA_REINITIALIZE);\n                this._mainStore.chart.setChartAvailability(true);\n            } else {\n                this._emitter.emit(Feed.EVENT_MASTER_DATA_UPDATE, dataUpdate);\n            }\n        } else {\n            this._emitter.emit(Feed.EVENT_COMPARISON_DATA_UPDATE, {\n                symbol: comparisonChartSymbol,\n                ...dataUpdate,\n            });\n        }\n    }\n    static getFirstEpoch({ candles, history }: TicksHistoryResponse) {\n        if (candles && candles.length > 0) {\n            return candles[0].epoch;\n        }\n        if (history && history.times && history.times.length > 0) {\n            const { times } = history;\n            return +times[0];\n        }\n    }\n    onMasterDataUpdate(callback: Listener) {\n        this._emitter.on(Feed.EVENT_MASTER_DATA_UPDATE, callback);\n    }\n    offMasterDataUpdate(callback: Listener) {\n        this._emitter.off(Feed.EVENT_MASTER_DATA_UPDATE, callback);\n    }\n    onMasterDataReinitialize(callback: Listener) {\n        this._emitter.on(Feed.EVENT_MASTER_DATA_REINITIALIZE, callback);\n    }\n    offMasterDataReinitialize(callback: Listener) {\n        this._emitter.off(Feed.EVENT_MASTER_DATA_REINITIALIZE, callback);\n    }\n    onComparisonDataUpdate(callback: Listener) {\n        this._emitter.on(Feed.EVENT_COMPARISON_DATA_UPDATE, callback);\n    }\n    onPagination(callback: Listener) {\n        this._emitter.on(Feed.EVENT_ON_PAGINATION, callback);\n    }\n    offPagination(callback: Listener) {\n        this._emitter.off(Feed.EVENT_ON_PAGINATION, callback);\n    }\n    onStartPagination(callback: Listener) {\n        this._emitter.on(Feed.EVENT_START_PAGINATION, callback);\n    }\n    offStartPagination(callback: Listener) {\n        this._emitter.off(Feed.EVENT_START_PAGINATION, callback);\n    }\n    onConnectionChanged() {\n        const isOpened = this._mainStore.state.isConnectionOpened;\n        if (isOpened === undefined || isOpened === this._isConnectionOpened) {\n            return;\n        }\n        this._isConnectionOpened = isOpened;\n        if (isOpened) {\n            this._onConnectionReopened();\n        } else {\n            this._onConnectionClosed();\n        }\n    }\n    _onConnectionClosed() {\n        for (const key in this._activeStreams) {\n            this._activeStreams[key].pause();\n        }\n        this._connectionClosedDate = new Date();\n    }\n    _onConnectionReopened() {\n        const keys = Object.keys(this._activeStreams);\n        if (keys.length === 0) {\n            return;\n        }\n        const { granularity } = this._unpackKey(keys[0]);\n        const elapsedSeconds =\n            ((((new Date() as unknown) as number) - ((this._connectionClosedDate as unknown) as number)) / 1000) | 0;\n        const maxIdleSeconds = (granularity || 1) * this._stx.chart.maxTicks;\n        if (elapsedSeconds >= maxIdleSeconds) {\n            this._mainStore.chart.refreshChart();\n        } else {\n            for (const key of keys) {\n                this._resumeStream(key);\n            }\n        }\n        this._connectionClosedDate = undefined;\n    }\n    _resumeStream(key: string) {\n        const { symbol } = this._unpackKey(key);\n        const comparisonChartSymbol = this._stx.chart.symbol !== symbol ? symbol : undefined;\n\n        this._activeStreams[key].resume().then((params?: TQuoteResponse) => {\n            const { quotes } = params as TQuoteResponse;\n            if (this._stx.isDestroyed) return;\n            this._appendChartData(quotes, key, comparisonChartSymbol);\n        });\n    }\n    _getKey({ symbol, granularity }: { symbol: string; granularity: TGranularity }) {\n        return `${symbol}-${granularity}`;\n    }\n    _unpackKey(key: string) {\n        const [symbol, granularity] = key.split('-');\n        return { symbol, granularity: +granularity };\n    }\n    _trimQuotes(quotes: TQuote[] = []) {\n        let startTickIndex = null;\n        let endTickIndex = null;\n        let trimmedQuotes = quotes;\n        if (!trimmedQuotes.length) return [];\n        if (this.startEpoch && this.margin) {\n            startTickIndex = trimmedQuotes.findIndex(\n                tick => CIQ.strToDateTime(tick.Date) >= CIQ.strToDateTime(getUTCDate(this.startEpoch as number))\n            );\n            if (startTickIndex > -1) {\n                trimmedQuotes = trimmedQuotes.slice(startTickIndex - 1);\n            }\n        }\n        if (this.endEpoch && this.margin) {\n            endTickIndex = trimmedQuotes.findIndex(\n                tick => CIQ.strToDateTime(tick.Date) >= CIQ.strToDateTime(getUTCDate(this.endEpoch as number))\n            );\n            if (endTickIndex > -1) {\n                const addon = trimmedQuotes[endTickIndex].Date === getUTCDate(this.endEpoch) ? 2 : 1;\n                trimmedQuotes = trimmedQuotes.slice(0, endTickIndex + addon);\n            }\n        }\n        return trimmedQuotes;\n    }\n}\nexport default Feed;\n"],"sourceRoot":""}